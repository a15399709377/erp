<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.erp.mapper.procedure.procedureMapper">
	<select id="getAllFile" resultType="d_file">
		SELECT * FROM D_FILE WHERE check_tag='S001-1' AND delete_tag='C001-0' AND design_module_tag='W001-1' AND type='Y001-1' AND design_procedure_tag='G001-0'
	</select>
	
	<select id="getAllFileNum" resultType="int">
		SELECT count(1) FROM D_FILE WHERE check_tag='S001-1' AND delete_tag='C001-0' AND design_module_tag='W001-1' AND type='Y001-1' AND design_procedure_tag='G001-0'
	</select>
	
	<select id="getD_FileByProduct_id" resultType="d_file">
		SELECT * FROM D_FILE WHERE product_id=#{product_id}
	</select>
	
	<insert id="addProcedure">
		insert into M_PROCEDURE values(null,#{m.parent_id},#{m.details_number},
		<choose>
			<when test="m.procedure_name==null">
				null
			</when>
			<otherwise>
				#{m.procedure_name}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.labour_hour_amount==null">
				null
			</when>
			<otherwise>
				#{m.labour_hour_amount}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.real_labour_hour_amount==null">
				null
			</when>
			<otherwise>
				#{m.real_labour_hour_amount}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.subtotal==null">
				null
			</when>
			<otherwise>
				#{m.subtotal}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.real_subtotal==null">
				null
			</when>
			<otherwise>
				#{m.real_subtotal}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.module_subtotal==null">
				null
			</when>
			<otherwise>
				#{m.module_subtotal}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.real_module_subtotal==null">
				null
			</when>
			<otherwise>
				#{m.real_module_subtotal}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.cost_price==null">
				null
			</when>
			<otherwise>
				#{m.cost_price}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.demand_amount==null">
				null
			</when>
			<otherwise>
				#{m.demand_amount}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.real_amount==null">
				null
			</when>
			<otherwise>
				#{m.real_amount}
			</otherwise>
		</choose>,
		#{m.procedure_finish_tag},#{m.procedure_transfer_tag}
		);
	</insert>
	
	<insert id="addProcedureDetails">
		insert into M_DESIGN_PROCEDURE_DETAILS values(null,#{m.parent_id},#{m.details_number},#{m.procedure_id},
		<choose>
			<when test="m.procedure_name==null">
				null
			</when>
			<otherwise>
				#{m.procedure_name}
			</otherwise>
		</choose>,
		#{m.labour_hour_amount},
		<choose>
			<when test="m.procedure_describe==null">
				null
			</when>
			<otherwise>
				#{m.procedure_describe}
			</otherwise>
		</choose>,
		#{m.amount_unit},#{m.cost_price},
		<choose>
			<when test="m.subtotal==null">
				null
			</when>
			<otherwise>
				#{m.subtotal}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.module_subtotal==null">
				null
			</when>
			<otherwise>
				#{m.module_subtotal}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.register==null">
				null
			</when>
			<otherwise>
				#{m.register}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.register_time==null">
				null
			</when>
			<otherwise>
				#{m.register_time}
			</otherwise>
		</choose>,
		'D002-1','D003-0'
		)
	</insert>
	
	<insert id="addProcedure_design">
		insert into M_DESIGN_PROCEDURE values(null,#{m.design_id}
		,#{m.first_kind_id},#{m.first_kind_name},
		#{m.second_kind_id},#{m.second_kind_name},#{m.third_kind_id},#{m.third_kind_name},
		#{m.product_id},
		<choose>
			<when test="m.product_name==null">
				null
			</when>
			<otherwise>
				#{m.product_name}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.procedure_describe==null">
				null
			</when>
			<otherwise>
				#{m.procedure_describe}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.cost_price_sum==null">
				null
			</when>
			<otherwise>
				#{m.cost_price_sum}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.module_cost_price_sum==null">
				null
			</when>
			<otherwise>
				#{m.module_cost_price_sum}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.designer==null">
				null
			</when>
			<otherwise>
				#{m.designer}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.register==null">
				null
			</when>
			<otherwise>
				#{m.register}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.register_time==null">
				null
			</when>
			<otherwise>
				#{m.register_time}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.checker==null">
				null
			</when>
			<otherwise>
				#{m.checker}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.check_time==null">
				null
			</when>
			<otherwise>
				#{m.check_time}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.check_suggestion==null">
				null
			</when>
			<otherwise>
				#{m.check_suggestion}
			</otherwise>
		</choose>,
		'S001-0',
		<choose>
			<when test="m.changer==null">
				null
			</when>
			<otherwise>
				#{m.changer}
			</otherwise>
		</choose>,
		<choose>
			<when test="m.change_time==null">
				null
			</when>
			<otherwise>
				#{m.change_time}
			</otherwise>
		</choose>,
		'B002-0','G002-0','G003-0'
		)
	</insert>

	<select id="getProcedureIdByproduct_id" resultType="int">
		SELECT id FROM M_DESIGN_PROCEDURE order by id DESC limit 1
	</select>
	
	<select id="getdesign_id" resultType="int">
		SELECT design_id FROM M_DESIGN_PROCEDURE order by id DESC limit 1
	</select>
	
	<update id="ToExamineDesign_Procedure">
		update M_DESIGN_PROCEDURE set check_tag='S001-1' where id=#{id}
	</update>
	
	<update id="updateFileBydesign_procedure_tag">
		UPDATE D_FILE SET design_procedure_tag='G001-1' WHERE id=#{id}
	</update>
	
	<select id="getAllM_Design_procedure" resultType="m_design_procedure">
		SELECT * FROM m_design_procedure WHERE check_tag='S001-0' or check_tag='S001-2'
	</select>
	
	<select id="getAllD_Module" resultType="D_module">
		SELECT * FROM D_module 
	</select>
	
	<select id="getM_Design_Procedure" resultType="m_design_procedure">
		SELECT * FROM m_design_procedure where id=#{id}
	</select>
	
	<select id="getDesign_Procedure_details" resultType="m_design_procedure_details">
		SELECT * FROM m_design_procedure_details WHERE parent_id=#{id}
	</select>
	
	<select id="getM_Produce" resultType="m_design_procedure">
		SELECT * FROM m_design_procedure where design_id=#{id}
	</select>
	
	<select id="getAllesion" resultType="m_design_procedure">
		select * from m_design_procedure
	</select>
	<select id="getAllm_design_procedureBycheck_tag" resultType="m_design_procedure">
		select * from m_design_procedure where check_tag='S001-1'
	</select>
</mapper>